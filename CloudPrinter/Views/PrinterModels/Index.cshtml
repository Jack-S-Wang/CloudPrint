@model IEnumerable<CloudPrinter.Models.PrinterModels>

@{
    ViewBag.Title = "云打印主页";
}

<h2>云打印应用程序</h2>
@if (ViewBag.loginAccount.Equals(ViewBag.superAccount))
{
    <p>
        @Html.ActionLink("注册新打印机", "Create", new { userAccount = ViewBag.userAccount })
    </p>
}

<div>
    @Html.DisplayNameFor(model => model.printerNumber)
    <input type="text" class="text-left" id="number" />
    内容：<input type="text" class="text-left" id="dataInfo" />
    <input type="submit" value="打印" id="print" />
</div>
<table class="table">
    
    @Html.Partial("PerUserList")

    @*@foreach (var item in Model)
    {
        if (ViewBag.userAccount.Equals(item.userAccount))
        {
            var number = item.printerNumber;
            <tr class="printInfo">
                <td>
                    @Html.DisplayFor(modelItem => item.printerNumber)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.printerName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.mState)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.cState)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.stateMessage)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.userName)
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.registerTime)
                </td>
                <td>
                    @Html.ActionLink("编辑", "Edit", new { printerNumber = item.printerNumber }) |
                    @Html.ActionLink("信息", "Details", new { printerNumber = item.printerNumber }) |
                    @if (ViewBag.loginAccount.Equals(ViewBag.superAccount))
                    {
                        @Html.ActionLink("删除", "Delete", new { printerNumber = item.printerNumber }) <label>|</label>
                    }
                    <label class="label" onclick="pnumber('@number')" style="color:#428bca;font-size:75%;" onmouseover="this.className='overLa'" onmouseout="this.className='outLa'">选择打印</label>
                </td>
            </tr>
        }
    }*@
</table>
<style>
    .overLa {
        cursor: pointer;
        text-decoration: underline;
    }

    .outLa {
        cursor: auto;
        text-decoration: none;
    }
</style>
<script src="~/Scripts/jquery-1.10.2.js"></script>
<script type="text/javascript">
    $(function () {
        setInterval(function () {
            $.get('/PrinterModels/PerUserList', { "userAccount" : "@Html.Raw(ViewBag.userAccount)" }, appTable);
        }, 3000);
    })

    function appTable(content) {
        //$(".printInfo").remove();
        $(".table").html(content);
    };

    function pnumber(number) {
        document.getElementById('number').value = number;
        }
            $("#print").click(function () {
                var number = $('#number').val();
                $.ajax({
                    "url": "/API/SendHttp?printerNumber=" + number + "&printDt=" + $('#dataInfo').val(),
                    "method": "POST",
                    "processData": true,
                    "contentType": false,
                    "headers": {
                        "Cache-Control": "no-cache",
                    },
                    success: function (ref) {
                        alert(ref);
                    },
                    error: function (ref) {
                        alert(ref);
                    }
                })
            })
</script>
